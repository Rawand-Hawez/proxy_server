You Are a Senior Backend Engineer
1. Functional Requirements (Backend Only)
App Scope
A unified backend to manage property rental operations for two buildings:
Ster Tower
2nd Avenue
The backend must provide CRUD operations for:
Buildings
Floors
Units
Tenants
Leases
Reports (Vacancy, Upcoming Expirations)
✅ 2. Database Schema (SQLite)
Use this exact schema, without modification.
CREATE TABLE buildings (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL UNIQUE,
  code TEXT NOT NULL UNIQUE,
  address TEXT,
  notes TEXT
);

CREATE TABLE floors (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  building_id INTEGER NOT NULL REFERENCES buildings(id) ON DELETE CASCADE,
  label TEXT NOT NULL,              -- 'GF', '1', '2', 'Basement', 'Roof', etc.
  level_no INTEGER,                 -- integer floor number or NULL for GF/Basement/etc
  sort_order INTEGER NOT NULL,      
  UNIQUE (building_id, label)
);

CREATE TABLE units (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  building_id INTEGER NOT NULL REFERENCES buildings(id) ON DELETE CASCADE,
  floor_id INTEGER NOT NULL REFERENCES floors(id) ON DELETE RESTRICT,
  code TEXT NOT NULL,               -- standardized code (e.g., ST-GF-01)
  name TEXT NOT NULL,               -- display name
  usage_type TEXT NOT NULL,         -- office/showroom/storage/parking/roof/external
  rental_area_sqm REAL NOT NULL,
  status TEXT NOT NULL DEFAULT 'vacant', -- vacant/occupied/out/blocked
  is_active INTEGER NOT NULL DEFAULT 1,
  notes TEXT,
  UNIQUE (building_id, code)
);

CREATE TABLE tenants (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL UNIQUE,
  category TEXT,           -- consulate/company/embassy/retail/internal
  contact_name TEXT,
  contact_phone TEXT,
  contact_email TEXT,
  notes TEXT
);

CREATE TABLE leases (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  unit_id INTEGER NOT NULL REFERENCES units(id) ON DELETE CASCADE,
  tenant_id INTEGER NOT NULL REFERENCES tenants(id) ON DELETE RESTRICT,
  start_date TEXT,
  end_date TEXT,
  status TEXT NOT NULL DEFAULT 'active', -- active/expired/terminated/planned
  rent_currency TEXT,
  rent_amount REAL,
  raw_period_text TEXT,                 -- original Excel string
  created_at TEXT NOT NULL DEFAULT (datetime('now')),
  updated_at TEXT NOT NULL DEFAULT (datetime('now'))
);

CREATE TRIGGER leases_update_timestamp
AFTER UPDATE ON leases
BEGIN
  UPDATE leases SET updated_at = datetime('now') WHERE id = NEW.id;
END;
✅ 3. Unit Code Standardization (Mandatory Business Rule)
Format:
<BUILDINGCODE>-<LEVEL>-<SEQ>
Examples:
ST-GF-01
ST-04-01
ST-B1-01
AV2-GF-07
AV2-01-03
Regex validation:
^[A-Z0-9]{2,4}-(GF|RF|PK|EX|B[0-9]+|[0-9]{2})-[0-9]{2}$
Auto-generation rules:
If code missing → backend must generate:
based on building code
floor → level code
next sequential unit number (2 digits)
✅ 4. API Specification (All Required Endpoints)
Below is the full API contract front-end developers will follow.
Buildings
GET /buildings
Returns all buildings.
GET /buildings/:id
Returns one building.
POST /buildings
Body:
{
  "name": "Ster Tower",
  "code": "ST",
  "address": "...",
  "notes": "..."
}
PUT /buildings/:id
Updates building info.
Floors
GET /buildings/:id/floors
Returns floors for a building, sorted.
GET /floors/:id
POST /floors
{
  "building_id": 1,
  "label": "GF",
  "level_no": 0,
  "sort_order": 1
}
PUT /floors/:id
Units
GET /buildings/:id/units?status=vacant|occupied|out
List units by building.
GET /floors/:id/units
GET /units/:id
POST /units
{
  "building_id": 1,
  "floor_id": 3,
  "code": "ST-04-01",     // optional; auto-gen if missing
  "name": "Consulate Office",
  "usage_type": "office",
  "rental_area_sqm": 250,
  "status": "occupied",
  "notes": ""
}
PUT /units/:id
Update any field.
DELETE /units/:id
Tenants
GET /tenants?q=search
Search tenants.
GET /tenants/:id
POST /tenants
{
  "name": "Turkish Consulate",
  "category": "consulate",
  "contact_name": "",
  "contact_phone": "",
  "contact_email": "",
  "notes": ""
}
PUT /tenants/:id
Leases
GET /units/:id/leases
Returns all leases for unit.
GET /leases/:id
POST /leases
{
  "unit_id": 33,
  "tenant_id": 7,
  "start_date": "2024-01-01",
  "end_date": "2025-01-01",
  "rent_currency": "USD",
  "rent_amount": 25000,
  "raw_period_text": "1.1.2024 - 1.1.2025"
}
On creation:
unit status → occupied
PUT /leases/:id
POST /leases/:id/terminate
Marks lease as terminated:
lease status → terminated
unit status → vacant
Reporting Endpoints
GET /reports/vacancy?buildingId=1
Returns:
{
  "total_units": 50,
  "occupied_units": 32,
  "vacant_units": 18,
  "total_area": 12430,
  "rented_area": 8700,
  "vacant_area": 3730,
  "occupancy_percent": 69.98
}
GET /reports/expiring?buildingId=1&withinDays=90
Returns list of leases where end_date < NOW + 90 days.